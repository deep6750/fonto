function configureAssetPreviewGetRouteHandler(config) {
	return (req, res) => {
		const id = req.query.id;
		if (id && id.indexOf('..') !== -1) {
			res.status(403).end();
			return;
		}

		const filePath = req.cms.getPath(
			id,
			JSON.parse(req.query.context).editSessionToken
		);
		if (filePath) {
			res.sendFile(filePath, {
				cacheControl: !config.cacheControlDisabled,
				maxAge: config.cacheControlMaxAge,
			});
		} else {
			res.status(404).end();
		}
	};
}

export default configureAssetPreviewGetRouteHandler;
