const getDescendantNodes = require('./getDescendantNodes.cjs');

module.exports = function addWarningsForRemovedComments(
	warningsByFilename,
	filePath,
	...paths
) {
	const comments = new Set();
	paths.forEach((path) => {
		const descendantPaths = getDescendantNodes(path, true, true);
		descendantPaths.forEach((path) => {
			[]
				.concat(
					path.node.comments || [],
					path.node.leadingComments || [],
					path.node.trailingComments || [],
					path.node.innerComments || []
				)
				.forEach((comment) => {
					if (comments.has(comment)) {
						return;
					}
					comments.add(comment);
					warningsByFilename.add(
						filePath,
						path.buildCodeFrameError(
							`Possibly lost comment on removal or replacement of code after transform:\n${
								comment.value && comment.value.length > 50
									? `${comment.value.substring(0, 50)}...`
									: comment.value
							}`
						)
					);
				});
		});
	});
};
