import fs from 'fs-extra';
import path from 'path';

export default async function mergeIndexPageAndManifest(
	outputDir,
	warningsByFilename
) {
	const indexPageFilePath = path.join(outputDir, 'config/index-page.json');
	const manifestFilePath = path.join(outputDir, 'manifest.json');

	try {
		const indexPageJson = await fs.readJson(indexPageFilePath);
		const manifestJson = await fs.readJson(manifestFilePath);

		manifestJson.favicon = indexPageJson.favicon;
		manifestJson.name = indexPageJson.title;

		await fs.writeJson(manifestFilePath, manifestJson, { spaces: '\t' });
		await fs.remove(indexPageFilePath);
	} catch (error) {
		error.message = `${indexPageFilePath}: ${error.message}`;
		warningsByFilename.add(indexPageFilePath, error);
	}
}
