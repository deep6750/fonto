const moveComments = require('../astHelpers/moveComments.cjs');

module.exports = (babel, options, _cwd) => {
	const { types: t } = babel;

	return {
		visitor: {
			StringLiteral(path) {
				// Guard against string literals that aren't in an import declaration.
				if (!t.isImportDeclaration(path.getStatementParent())) {
					return;
				}

				const source = path.node.value;
				if (!options.mainJsModuleNames.includes(source)) {
					return;
				}

				// Replace the first, and only the first, '/' with '/src/' to fix the path.
				const sourceNode = t.stringLiteral(`${source}/main`);
				moveComments.asIs(babel, sourceNode, path.node);
				path.replaceWith(sourceNode);
			},
		},
	};
};
