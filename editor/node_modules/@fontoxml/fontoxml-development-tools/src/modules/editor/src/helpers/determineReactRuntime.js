import fs from 'fs-extra';
import { resolve } from 'path';

const JSX_RUNTIME_ALIAS = 'react/jsx-runtime';
const MANIFEST_FILE = 'fonto-manifest.json';

export default function determineReactRuntime(paths) {
	return [
		resolve(paths.platformLinkedVendorsFolder, MANIFEST_FILE),
		resolve(paths.platformVendorsFolder, MANIFEST_FILE),
	].some((manifestPath) => {
		try {
			const manifest = fs.readJsonSync(manifestPath);
			return manifest.importAliases.some((importAlias) => {
				return importAlias.alias === JSX_RUNTIME_ALIAS;
			});
		} catch (_err) {
			return false;
		}
	})
		? 'automatic'
		: 'classic';
}
