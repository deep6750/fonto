import prettier from 'prettier';

const DEFAULT_OPTIONS = {
	endOfLine: 'auto',
	singleQuote: true,
	tabWidth: 4,
	useTabs: true,
};

/**
 * Write the output file to disk.
 *
 * @param {Object} file
 * @param {boolean} forceDefaultConfig
 *
 * @return {Promise}
 */
export default async function prettifyJsFile(file, forceDefaultConfig = false) {
	const fileInfo = await prettier.getFileInfo(file.filePath);
	const prettierConfig = await prettier.resolveConfig(file.filePath);

	let options;
	if (!prettierConfig || forceDefaultConfig) {
		options = {
			...DEFAULT_OPTIONS,
			parser: fileInfo.inferredParser,
		};
	} else {
		options = {
			...prettierConfig,
			parser: fileInfo.inferredParser,
		};
	}

	file.code = await prettier.format(file.code, options);

	return file;
}
