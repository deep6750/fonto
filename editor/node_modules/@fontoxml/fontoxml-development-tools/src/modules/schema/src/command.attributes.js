import path from 'path';

import createAttributesTable from './api/createAttributesTable.js';

export default async (moduleRegistration) => {
	const table = await createAttributesTable(moduleRegistration);

	moduleRegistration
		.registerCommand(
			'attributes',
			path.resolve(
				moduleRegistration.getPath(),
				'src',
				'command.attributes.controller.js'
			)
		)
		.addAlias('list-attributes')
		.setDescription(
			'Output a table with information about all attributes in a schema.'
		)

		.setRequiresEditorRepository()
		.setRequiresEditorVersionToMatchFdt()

		.addOption(
			'schema',
			's',
			'In a multi-schema application, specify (a part of) the path to the source schema.json.',
			false
		)
		.addOption(
			new moduleRegistration.MultiOption('blacklist-ns').setDescription(
				'Do not list attributes of this namespace, eg "mml".'
			)
		)
		.addOption(table.sortOption)
		.addOption(table.columnsOption)
		.addOption(table.exportOption)

		.addExample(
			`${moduleRegistration.getAppInfo().name} attributes`,
			'Output information about all the attributes if the application has only one schema.json.'
		)
		.addExample(
			`${moduleRegistration.getAppInfo().name} attributes -s map`,
			'Output information about all the attributes if the application has one shell in a package named something with "map".'
		)
		.addExample(
			`${
				moduleRegistration.getAppInfo().name
			} attributes -s packages/non-standard-schema-package/src/data.json`,
			'Output information about all the attributes from a schema.json in a non-standard location.'
		)
		.addExample(
			`${
				moduleRegistration.getAppInfo().name
			} attributes --blacklist-ns xml`,
			'Output information about all the attributes, but do not output attributes from the xml namespace.'
		);
};
