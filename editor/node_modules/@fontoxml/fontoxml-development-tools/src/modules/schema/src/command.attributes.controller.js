import createAttributesTable from './api/createAttributesTable.js';
import getClosestMatchingSchemaSummary from './api/getClosestMatchingSchemaSummary.js';

export default async function attributesCommand(req, res) {
	res.caption(req.command.getLongName());

	const destroySpinner = res.spinner('Looking up schemas...');

	const schemaSummary = getClosestMatchingSchemaSummary(
		req.fdt.editorRepository.path,
		req.options.schema
	);

	destroySpinner();
	res.break();

	const table = await createAttributesTable(req.command.getModuleRegistration());
	table.print(
		res,
		req.options.columns,
		schemaSummary.getAllAttributes().filter((attribute) => {
			if (!req.options['blacklist-ns'].length) {
				return true;
			}

			const ns = attribute.getNamespace();

			if (!ns) {
				return true;
			}

			return req.options['blacklist-ns'].indexOf(ns) === -1;
		}),
		req.options.sort,
		req.options.export
	);
}
