import getOperationMessages from './getOperationMessages.js';
import getSourceMessages from './getSourceMessages.js';

const DEFAULT_OPTIONS = {
	includeLineAndColumn: true,
};

async function getMessagesForPackage(pkg, options) {
	return [
		...(await getSourceMessages(pkg, options)),
		...(await getOperationMessages(pkg)),
	];
}

/**
 * @param  {{name: string, path: string}[]}  packages
 * @param  {Object}                          [options]
 * @param  {boolean}                         [options.includeLineAndColumn=true]
 *
 * @return  {Promise.<Message[]>}
 */
export default async function extractMessages(packages, options) {
	const messagesForPackages = await Promise.all(
		packages.map((pkg) =>
			getMessagesForPackage(pkg, { ...DEFAULT_OPTIONS, ...options }),
		),
	);
	return messagesForPackages.flat();
}
