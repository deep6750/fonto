import fs from 'fs-extra';
import path from 'path';

/**
 * Create a package directory path based on pre-existing locations. If the package already
 * exists in packages that will be used, otherwise packages-shared will be checked and if found
 * used. Defaults to using the packages folder.
 *
 * @param {string} outputPath The path of the Fonto Editor, or the schema source directory.
 * @param {string} packageName The name of the corresponding schema package.
 *
 * @return {Promise}
 */
export default async function createPackageDirectoryPath(
	outputPath,
	packageName
) {
	const packageDirectoryPath = path.join(outputPath, 'packages', packageName);
	if (await fs.pathExists(packageDirectoryPath)) {
		return packageDirectoryPath;
	}

	const packagesSharedDirectoryPath = path.join(
		outputPath,
		'packages-shared',
		packageName
	);
	if (await fs.pathExists(packagesSharedDirectoryPath)) {
		return packagesSharedDirectoryPath;
	}

	return packageDirectoryPath;
}
