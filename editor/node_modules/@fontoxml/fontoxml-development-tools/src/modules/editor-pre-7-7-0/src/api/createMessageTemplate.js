import fs from 'fs-extra';

import deduplicateMessages from '../../../localization/src/api/deduplicateMessages.js';
import Message from '../../../localization/src/api/Message.js';

/**
 * Create a messages-template.json file for a Fonto Editor instance based on the localization files
 * from the (selected) packages from the Fonto Editor SDK bundle.
 *
 * @param {Array}  messagesFiles        An array of message template JSON objects from the SDK packages.
 * @param {string} messagesTemplatePath The output path for the message template file.
 *
 * @return {Promise}
 */
export default async (messagesFiles, messagesTemplatePath) => {
	if (!messagesFiles || !messagesFiles.length) {
		throw new Error(
			'Could not create localization messages template because there are no message files.'
		);
	}

	const messagesPerPackage = messagesFiles.map((messageFile) =>
		messageFile.map((msg) => Message.fromJSON(msg))
	);

	const messages = deduplicateMessages(
		messagesPerPackage.reduce((vs, v) => vs.concat(v), [])
	);

	await fs.writeJSON(messagesTemplatePath, messages);
};
