import fs from 'fs-extra';

export default async (manifestPath, sdkManifest, addons) => {
	// Read the file.
	const manifest = await fs.readJson(manifestPath);

	// Update the addons.
	manifest.addonNames = addons.sort();

	// Update the build date and version.
	if (!sdkManifest || !sdkManifest.buildDate || !sdkManifest.version) {
		throw new Error('Could not get build date and version of the SDK.');
	}
	manifest.sdkBuildDate = sdkManifest.buildDate;
	manifest.sdkVersion = sdkManifest.version.format();

	// Delete old and deprecated 'legacyAddonNames' property if it's still
	// present.
	delete manifest.legacyAddonNames;

	// Update the file.
	await fs.writeJson(manifestPath, manifest, {
		spaces: '\t',
	});
};
